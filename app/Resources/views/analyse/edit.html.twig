{% extends 'layout.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <link href="{{ asset('assets/vendor/datatables/media/css/dataTables.bootstrap.css') }}" rel="stylesheet"
          xmlns="http://www.w3.org/1999/html"/>
    <link href="{{ asset('css/analyse.css') }}" rel="stylesheet" />
{% endblock %}



{% block appWindow %}
    <script type="text/javascript">
        var jsonChartData = '{{ jsonChartData | raw }}';
    </script>
    {% block analyse_params %}
        <div class="col-lg-12 panel">
            <div class="panel-heading">
                <h1 class="panel-title">Edit your analyse </h1>
                {#{{ dump(jsonChartData) }}#}
            </div>
            <div class="col-lg-2">
                {% block analyse_resume %}
                    <div class="thumbnail analyse_thumbnail">
                        <div class="caption text-center">
                            <input type="hidden" class="analyse_id" value="{{ analyse.getId }}">
                            <h4>{{ analyse.getName }}</h4>
                            <p>description</p>
                        </div>
                    </div>
                {% endblock %}
                {% block param_creation %}
                    {{ render(controller('AppBundle:Param:add', {'analyseId': analyse.getId})) }}
                {% endblock %}
            </div>

            <div class="col-lg-10">

                <div class="row analyse_toolbar">
                    {% block analyse_toolbar %}
                        <nav class="navbar-default navbar-top">
                            <a href="#"><button type="button" class="btn btn-default" id="chart_button"><i class="fa fa-bar-chart"></i></button></a>
                            <a href="#"><button type="button" class="btn btn-default"><i class="fa fa-share"></i></button></a>
                        </nav>
                    {% endblock %}
                </div>

                <div class="row">
                    {% block datatable %}
                        <section id="headTest">
                            {% form_theme analyse_form 'form/fieldsAnalyse.html.twig' %}
                            {{ form_start(analyse_form) }}
                            <ul>
                                <li class="analyse_metadata">
                                    {{ form_label(analyse_form.name) }}
                                    {{ form_widget(analyse_form.name) }}
                                </li>
                                <li class="analyse_metadata hidden" >
                                    {{ form_label(analyse_form.created) }}
                                    {{ form_widget(analyse_form.created) }}
                                </li>
                                <li class="analyse_metadata">{{ form_widget(analyse_form.save) }}</li>
                                <li class="analyse_metadata">
                                    <a href="{{ path('analyse_add_dataserie', {'analyseId': analyse.getId}) }}" class="btn btn-primary" role="button">
                                        <i class="fa fa-plus-square"></i><i class="fa fa-table iconAnalyse"></i>
                                    </a>

                                </li>
                            </ul>
                            <hr>
                            <ul>
                                {% for param in analyse_form.params1 %}
                                    {%  if loop.index == 1 %}
                                        <li class="analyse_param" style="width:152px;">
                                            <ul class="params_params">
                                                <li>{{ form_label(param.name) }}</li>
                                                <section class="moreParamSection" style="display: none;">
                                                    <li>{{ form_label(param.min) }}</li>
                                                    <li>{{ form_label(param.max) }}</li>
                                                    <li>{{ form_label(param.ponderation) }}</li>
                                                    <li>{{ form_label(param.unit) }}</li>
                                                    <li>{{ form_label(param.type) }}</li>
                                                </section>
                                            </ul>
                                        </li>
                                    {% endif %}
                                    <li class="analyse_param">
                                        {% form_theme param 'form/fieldsParam.html.twig' %}
                                        <ul class="params_params">
                                            <li class="hidden">
                                                {{ form_label(param.analyse1) }}
                                                {{ form_widget(param.analyse1) }}
                                            </li>
                                            <li>
                                                <button type="button" class="moreParam" id="moreParam_{{ param.vars.value.id }}" name="moreParam_{{ param.vars.value.id }}"><i class="fa fa-plus-circle"></i></button>
                                                <a href="{{ path('param_delete', {'paramId': param.vars.value.id}) }}"><button type="button"><i class="fa fa-trash moreParamIcon"></i></button></a>
                                                {{ form_widget(param.save) }}
                                            </li>
                                            <li>{{ form_widget(param.name) }}</li>
                                            <section class="moreParamSection" id="section_moreParam_{{ param.vars.value.id }}" name="section_moreParam_{{ param.vars.value.id }}" style="display: none;">
                                                <li>{{ form_widget(param.min) }}</li>
                                                <li>{{ form_widget(param.max) }}</li>
                                                <li>{{ form_widget(param.ponderation) }}</li>
                                                <li>{{ form_widget(param.unit) }}</li>
                                                <li>{{ form_widget(param.type) }}</li>
                                            </section>
                                        </ul>
                                    </li>
                                {% endfor %}
                            </ul>
                            {{ form_end(analyse_form) }}
                        </section>
                    {% endblock %}

                    {% block dataseries %}
                        {{ render(controller('AppBundle:Dataserie:list', {'analyseId' : analyse.getId})) }}
                    {% endblock %}

                    {% block analyse_chart %}
                        <canvas id="myChart" width="400" height="400"></canvas>
                    {% endblock %}
                </div>
            </div>
        </div>
    {% endblock %}
{% endblock %}


{% block javascripts %}
    {{ parent() }}
    {% javascripts 'additionnal_javascript' %}
    <script src="{{ asset('assets/vendor/datatables/media/js/jquery.dataTables.js') }}" type="text/javascript"></script>
    <script src="{{ asset('assets/vendor/datatables/media/js/dataTables.bootstrap.js') }}" type="text/javascript"></script>
    <script src="{{ asset('assets/vendor/Chart.js/Chart.min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('assets/vendor/verify/verify.notify.min.js') }}" type="text/javascript"></script>
    <script src="https://www.google.com/jsapi" type="text/javascript" ></script>
    <script src="{{ asset('js/analyse.js') }}" type="text/javascript" charset="utf-8"></script>
    {% endjavascripts %}
{% endblock %}

